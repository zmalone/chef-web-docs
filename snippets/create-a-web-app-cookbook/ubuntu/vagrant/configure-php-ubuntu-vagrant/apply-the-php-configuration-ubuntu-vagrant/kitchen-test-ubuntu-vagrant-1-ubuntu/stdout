-----> Starting Kitchen (v1.15.0)
-----> Cleaning up any prior instances of <default-ubuntu-1404>
-----> Destroying <default-ubuntu-1404>...
       ==> default: Forcing shutdown of VM...
       ==> default: Destroying VM and associated drives...
       Vagrant instance <default-ubuntu-1404> destroyed.
       Finished destroying <default-ubuntu-1404> (0m3.68s).
-----> Testing <default-ubuntu-1404>
-----> Creating <default-ubuntu-1404>...
       Bringing machine 'default' up with 'virtualbox' provider...
       ==> default: Importing base box 'bento/ubuntu-14.04'...
       ==> default: Checking if box 'bento/ubuntu-14.04' is up to date...
       ==> default: Setting the name of the VM: kitchen-lamp-default-ubuntu-1404_default_1490905247008_72658
       ==> default: Clearing any previously set network interfaces...
       ==> default: Preparing network interfaces based on configuration...
           default: Adapter 1: nat
           default: Adapter 2: hostonly
       ==> default: Forwarding ports...
           default: 22 (guest) => 2222 (host) (adapter 1)
       ==> default: Booting VM...
       ==> default: Waiting for machine to boot. This may take a few minutes...
           default: SSH address: 127.0.0.1:2222
           default: SSH username: vagrant
           default: SSH auth method: private key
           default: 
           default: Vagrant insecure key detected. Vagrant will automatically replace
           default: this with a newly generated keypair for better security.
           default: 
           default: Inserting generated public key within guest...
           default: Removing insecure key from the guest if it's present...
           default: Key inserted! Disconnecting and reconnecting using new SSH key...
       ==> default: Machine booted and ready!
       ==> default: Checking for guest additions in VM...
       ==> default: Setting hostname...
       ==> default: Configuring and enabling network interfaces...
       ==> default: Mounting shared folders...
           default: /tmp/omnibus/cache => /root/.kitchen/cache
       ==> default: Machine not provisioned because `--no-provision` is specified.
       [SSH] Established
       Vagrant instance <default-ubuntu-1404> created.
       Finished creating <default-ubuntu-1404> (0m33.86s).
-----> Converging <default-ubuntu-1404>...
       Preparing files for transfer
       Preparing dna.json
       Resolving cookbook dependencies with Berkshelf 5.6.0...
       Removing non-cookbook files before transfer
       Preparing data_bags
       Preparing validation.pem
       Preparing client.rb
-----> Installing Chef Omnibus (install only if missing)
       Downloading https://omnitruck.chef.io/install.sh to file /tmp/install.sh
       Trying wget...
       Download complete.
       ubuntu 14.04 x86_64
       Getting information for chef stable  for ubuntu...
       downloading https://omnitruck.chef.io/stable/chef/metadata?v=&p=ubuntu&pv=14.04&m=x86_64
         to file /tmp/install.sh.1657/metadata.txt
       trying wget...
       sha1	a316f74e4a08fd4d2c535460c3aa16d30e09a08e
       sha256	fbf44670ab5b76e4f1a1f5357885dafcc79e543ccbbe3264afd40c15d604b6dc
       url	https://packages.chef.io/files/stable/chef/12.19.36/ubuntu/14.04/chef_12.19.36-1_amd64.deb
       version	12.19.36
       downloaded metadata file looks valid...
       /tmp/omnibus/cache/chef_12.19.36-1_amd64.deb already exists, verifiying checksum...
       Comparing checksum with sha256sum...
       checksum compare succeeded, using existing file!
       
       WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING
       
       You are installing an omnibus package without a version pin.  If you are installing
       on production servers via an automated process this is DANGEROUS and you will
       be upgraded without warning on new releases, even to new major releases.
       Letting the version float is only appropriate in desktop, test, development or
       CI/CD environments.
       
       WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING
       
       Installing chef 
       installing with dpkg...
       Selecting previously unselected package chef.
       (Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 35391 files and directories currently installed.)
       Preparing to unpack .../chef_12.19.36-1_amd64.deb ...
       Unpacking chef (12.19.36-1) ...
       Setting up chef (12.19.36-1) ...
       Thank you for installing Chef!
       Transferring files to <default-ubuntu-1404>
       [2017-03-30T20:21:52+00:00] INFO: Forking chef instance to converge...
       Starting Chef Client, version 12.19.36
       [2017-03-30T20:21:52+00:00] INFO: *** Chef 12.19.36 ***
       [2017-03-30T20:21:52+00:00] INFO: Platform: x86_64-linux
       [2017-03-30T20:21:52+00:00] INFO: Chef-client pid: 1744
       Creating a new client identity for default-ubuntu-1404 using the validator key.
       [2017-03-30T20:21:53+00:00] INFO: Client key /tmp/kitchen/client.pem is not present - registering
       [2017-03-30T20:21:53+00:00] INFO: HTTP Request Returned 404 Not Found: Object not found: chefzero://localhost:8889/nodes/default-ubuntu-1404
       [2017-03-30T20:21:53+00:00] INFO: Setting the run_list to ["recipe[lamp::default]"] from CLI options
       [2017-03-30T20:21:53+00:00] INFO: Run List is [recipe[lamp::default]]
       [2017-03-30T20:21:53+00:00] INFO: Run List expands to [lamp::default]
       [2017-03-30T20:21:53+00:00] INFO: Starting Chef Run for default-ubuntu-1404
       [2017-03-30T20:21:53+00:00] INFO: Running start handlers
       [2017-03-30T20:21:53+00:00] INFO: Start handlers complete.
[...]
       [2017-03-30T20:22:59+00:00] INFO: template[/etc/init/mysql-default.conf] mode changed to 644
       
        - change mode from '' to '0644'
        - change owner from '' to 'root'
        - change group from '' to 'root'
             * service[mysql-default] action start[2017-03-30T20:22:59+00:00] INFO: Processing service[mysql-default] action start (/tmp/kitchen/cache/cookbooks/mysql/libraries/mysql_service_manager_upstart.rb line 48)
       [2017-03-30T20:23:01+00:00] INFO: service[mysql-default] started
       
        - start service service[mysql-default]
           
         
         * mysql2_chef_gem[default] action install[2017-03-30T20:23:01+00:00] INFO: Processing mysql2_chef_gem[default] action install (lamp::database line 16)
       
         Recipe: build-essential::default
           * build_essential[install_packages] action install[2017-03-30T20:23:01+00:00] INFO: Processing build_essential[install_packages] action install (build-essential::default line 22)
       
             * apt_package[autoconf, binutils-doc, bison, build-essential, flex, gettext, ncurses-dev] action install[2017-03-30T20:23:01+00:00] INFO: Processing apt_package[autoconf, binutils-doc, bison, build-essential, flex, gettext, ncurses-dev] action install (/tmp/kitchen/cache/cookbooks/build-essential/resources/build_essential.rb line 28)
       [2017-03-30T20:23:01+00:00] INFO: apt_package[autoconf, binutils-doc, bison, build-essential, flex, gettext, ncurses-dev] is a virtual package, actually acting on package[libncurses5-dev]
       [2017-03-30T20:23:14+00:00] INFO: apt_package[autoconf, binutils-doc, bison, build-essential, flex, gettext, ncurses-dev] installed ["autoconf", "binutils-doc", "bison", "build-essential", "flex", "gettext", "ncurses-dev"] at ["2.69-6", "2.24-5ubuntu14.1", "2:3.0.2.dfsg-2", "11.6ubuntu6", "2.5.35-10.1ubuntu2", "0.18.3.1-1ubuntu3", "5.9+20140118-1ubuntu1"]
       
        - install version 2.69-6 of package autoconf
        - install version 2.24-5ubuntu14.1 of package binutils-doc
        - install version 2:3.0.2.dfsg-2 of package bison
        - install version 11.6ubuntu6 of package build-essential
        - install version 2.5.35-10.1ubuntu2 of package flex
        - install version 0.18.3.1-1ubuntu3 of package gettext
        - install version 5.9+20140118-1ubuntu1 of package ncurses-dev
           
           * mysql_client_installation_package[default] action create[2017-03-30T20:23:14+00:00] INFO: Processing mysql_client_installation_package[default] action create (/tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/provider_mysql2_chef_gem_mysql.rb line 16)
       
             * apt_package[mysql-client-5.5, libmysqlclient-dev] action install[2017-03-30T20:23:14+00:00] INFO: Processing apt_package[mysql-client-5.5, libmysqlclient-dev] action install (/tmp/kitchen/cache/cookbooks/mysql/libraries/mysql_client_installation_package.rb line 18)
        (up to date)
       (up to date)
           * gem_package[mysql2] action install[2017-03-30T20:23:14+00:00] INFO: Processing gem_package[mysql2] action install (/tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/provider_mysql2_chef_gem_mysql.rb line 21)
       [2017-03-30T20:25:49+00:00] INFO: gem_package[mysql2] installed mysql2 at 0.3.17
       
             - install version 0.3.17 of package mysql2
         
       Recipe: lamp::database
         * mysql_database[my_company] action create[2017-03-30T20:25:49+00:00] INFO: Processing mysql_database[my_company] action create (lamp::database line 27)
       
           - Creating schema 'my_company'
         * mysql_database_user[db_admin] action create[2017-03-30T20:25:49+00:00] INFO: Processing mysql_database_user[db_admin] action create (lamp::database line 33)
       
           - Creating user 'db_admin'@'127.0.0.1'
         * mysql_database_user[db_admin] action grant[2017-03-30T20:25:49+00:00] INFO: Processing mysql_database_user[db_admin] action grant (lamp::database line 33)
       [2017-03-30T20:25:49+00:00] INFO: mysql_database_user[db_admin]: granting with sql [GRANT all ON `my_company`.* TO 'db_admin'@'127.0.0.1' IDENTIFIED BY 'fakeadminpassword']
       
           - Granting privs for 'db_admin'@'127.0.0.1'
       [2017-03-30T20:25:49+00:00] INFO: httpd_config[default] sending restart action to httpd_service_debian_sysvinit[default] (delayed)
       Recipe: lamp::web
         * httpd_service_debian_sysvinit[default] action restart[2017-03-30T20:25:49+00:00] INFO: Processing httpd_service_debian_sysvinit[default] action restart (lamp::web line 12)
       
           * service[apache2-default] action restart[2017-03-30T20:25:49+00:00] INFO: Processing service[apache2-default] action restart (/tmp/kitchen/cache/cookbooks/httpd/libraries/httpd_service_debian_sysvinit.rb line 35)
       [2017-03-30T20:25:51+00:00] INFO: service[apache2-default] restarted
       
             - restart service service[apache2-default]
         
       [2017-03-30T20:25:51+00:00] INFO: Chef Run complete in 237.720367642 seconds
       
       Running handlers:
       [2017-03-30T20:25:51+00:00] INFO: Running report handlers
       Running handlers complete
       [2017-03-30T20:25:51+00:00] INFO: Report handlers complete
       
       Deprecated features used!
         Chef::Platform.set is deprecated at 14 locations:
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:4:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:5:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:6:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:7:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:8:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:9:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:10:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:11:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:12:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:13:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:14:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:15:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:16:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:17:in `<top (required)>'
          See https://docs.chef.io/deprecations_chef_platform_methods.html for further details.
         Chef::Platform.find_provider_for_node is deprecated at 1 location:
           - /opt/chef/embedded/lib/ruby/2.3.0/forwardable.rb:189:in `execute_each_resource'
          See https://docs.chef.io/deprecations_chef_platform_methods.html for further details.
         Chef::Platform.find_provider is deprecated at 1 location:
           - /opt/chef/embedded/lib/ruby/2.3.0/forwardable.rb:189:in `execute_each_resource'
          See https://docs.chef.io/deprecations_chef_platform_methods.html for further details.
         Chef::Platform.find is deprecated at 1 location:
           - /opt/chef/embedded/lib/ruby/2.3.0/forwardable.rb:189:in `execute_each_resource'
          See https://docs.chef.io/deprecations_chef_platform_methods.html for further details.
         nil is an invalid value for version of resource . In Chef 13, this warning will change to an error. Error: Property version must be one of: String!  You passed nil. at 1 location:
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/provider_mysql2_chef_gem_mysql.rb:17:in `block (2 levels) in <class:Mysql>'
          See https://docs.chef.io/deprecations_custom_resource_cleanups.html for further details.
       
       Chef Client finished, 133/213 resources updated in 03 minutes 59 seconds
       Finished converging <default-ubuntu-1404> (4m40.56s).
-----> Setting up <default-ubuntu-1404>...
       Finished setting up <default-ubuntu-1404> (0m0.00s).
-----> Verifying <default-ubuntu-1404>...
       Loaded  

Target:  ssh://vagrant@127.0.0.1:2222


  MySQL Config
     âœ”  entry [mysqld] port should eq "3306"
     âœ”  entry [mysqld] socket should eq "/run/mysql-default/mysqld.sock"
  Port 3306
     âœ”  should be listening
     âœ”  protocols should include "tcp"
  Command mysql
     âœ”  -h 127.0.0.1 -uroot -pfakerootpassword -s -e 'show databases;' stdout should match /mysql/
  System Package
     âœ”  apache2 should be installed
  Service apache2-default
     âœ”  should be enabled
     âœ”  should be running
  Command wget
     âœ”  -qSO- --spider localhost stderr should match /HTTP\/1\.1 200 OK/
  Port 80
     âœ”  should be listening

Test Summary: 10 successful, 0 failures, 0 skipped
       Finished verifying <default-ubuntu-1404> (0m1.31s).
-----> Destroying <default-ubuntu-1404>...
       ==> default: Forcing shutdown of VM...
       ==> default: Destroying VM and associated drives...
       Vagrant instance <default-ubuntu-1404> destroyed.
       Finished destroying <default-ubuntu-1404> (0m3.88s).
       Finished testing <default-ubuntu-1404> (5m23.31s).
-----> Kitchen is finished. (5m24.24s)