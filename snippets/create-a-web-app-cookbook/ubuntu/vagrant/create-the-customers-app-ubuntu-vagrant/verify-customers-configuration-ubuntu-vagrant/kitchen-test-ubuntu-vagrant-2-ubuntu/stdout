-----> Starting Kitchen (v1.15.0)
-----> Cleaning up any prior instances of <default-ubuntu-1404>
-----> Destroying <default-ubuntu-1404>...
       ==> default: Forcing shutdown of VM...
       ==> default: Destroying VM and associated drives...
       Vagrant instance <default-ubuntu-1404> destroyed.
       Finished destroying <default-ubuntu-1404> (0m3.75s).
-----> Testing <default-ubuntu-1404>
-----> Creating <default-ubuntu-1404>...
       Bringing machine 'default' up with 'virtualbox' provider...
       ==> default: Importing base box 'bento/ubuntu-14.04'...
       ==> default: Checking if box 'bento/ubuntu-14.04' is up to date...
       ==> default: Setting the name of the VM: kitchen-lamp_customers-default-ubuntu-1404_default_1490905936820_81100
       ==> default: Clearing any previously set network interfaces...
       ==> default: Preparing network interfaces based on configuration...
           default: Adapter 1: nat
       ==> default: Forwarding ports...
           default: 22 (guest) => 2222 (host) (adapter 1)
       ==> default: Booting VM...
       ==> default: Waiting for machine to boot. This may take a few minutes...
           default: SSH address: 127.0.0.1:2222
           default: SSH username: vagrant
           default: SSH auth method: private key
           default:
           default: Vagrant insecure key detected. Vagrant will automatically replace
           default: this with a newly generated keypair for better security.
           default:
           default: Inserting generated public key within guest...
           default: Removing insecure key from the guest if it's present...
           default: Key inserted! Disconnecting and reconnecting using new SSH key...
       ==> default: Machine booted and ready!
       ==> default: Checking for guest additions in VM...
       ==> default: Setting hostname...
       ==> default: Mounting shared folders...
           default: /tmp/omnibus/cache => /root/.kitchen/cache
       ==> default: Machine not provisioned because `--no-provision` is specified.
       [SSH] Established
       Vagrant instance <default-ubuntu-1404> created.
       Finished creating <default-ubuntu-1404> (0m33.30s).
-----> Converging <default-ubuntu-1404>...
       Preparing files for transfer
       Preparing dna.json
       Resolving cookbook dependencies with Berkshelf 5.6.0...
       Removing non-cookbook files before transfer
       Preparing data_bags
       Preparing validation.pem
       Preparing client.rb
-----> Installing Chef Omnibus (install only if missing)
       Downloading https://omnitruck.chef.io/install.sh to file /tmp/install.sh
       Trying wget...
       Download complete.
       ubuntu 14.04 x86_64
       Getting information for chef stable  for ubuntu...
       downloading https://omnitruck.chef.io/stable/chef/metadata?v=&p=ubuntu&pv=14.04&m=x86_64
         to file /tmp/install.sh.1507/metadata.txt
       trying wget...
       sha1	a316f74e4a08fd4d2c535460c3aa16d30e09a08e
       sha256	fbf44670ab5b76e4f1a1f5357885dafcc79e543ccbbe3264afd40c15d604b6dc
       url	https://packages.chef.io/files/stable/chef/12.19.36/ubuntu/14.04/chef_12.19.36-1_amd64.deb
       version	12.19.36
       downloaded metadata file looks valid...
       /tmp/omnibus/cache/chef_12.19.36-1_amd64.deb already exists, verifiying checksum...
       Comparing checksum with sha256sum...
       checksum compare succeeded, using existing file!

       WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING

       You are installing an omnibus package without a version pin.  If you are installing
[...]
           - execute mysql -h 127.0.0.1 -u db_admin -pfakeadminpassword -D 4thcoffee < /tmp/kitchen/cache/create-tables.sql
         * template[/var/www/customers/public_html/index.php] action create[2017-03-30T20:37:18+00:00] INFO: Processing template[/var/www/customers/public_html/index.php] action create (lamp_customers::default line 20)
       [2017-03-30T20:37:18+00:00] INFO: template[/var/www/customers/public_html/index.php] created file /var/www/customers/public_html/index.php

           - create new file /var/www/customers/public_html/index.php[2017-03-30T20:37:18+00:00] INFO: template[/var/www/customers/public_html/index.php] updated file contents /var/www/customers/public_html/index.php

           - update content in file /var/www/customers/public_html/index.php from none to 374532
           --- /var/www/customers/public_html/index.php	2017-03-30 20:37:18.574630952 +0000
           +++ /var/www/customers/public_html/.chef-index20170330-1594-197y40b.php	2017-03-30 20:37:18.574630952 +0000
           @@ -1 +1,56 @@
           +<!DOCTYPE html>
           +<html lang="en">
           +<head>
           +    <title>Customers</title>
           +    <style>
           +      table, th, td {
           +        border: 1px solid black;
           +        border-collapse: collapse;
           +        font-family: sans-serif;
           +        padding: 5px;
           +      }
           +      table tr:nth-child(even) td {
           +        background-color: #95c7ea;
           +      }
           +    </style>
           +</head>
           +<body>
           +<?php
           +$servername = "127.0.0.1";
           +$username = "db_admin";
           +$password = "fakeadminpassword";
           +$dbname = "4thcoffee";
           +
           +// Create connection
           +$conn = new mysqli($servername, $username, $password, $dbname);
           +
           +// Check connection
           +if ($conn->connect_error) {
           +    die("Connection failed: " . $conn->connect_error);
           +}
           +
           +// Perform SQL query
           +$sql = "SELECT * FROM customers";
           +$result = $conn->query($sql);
           +
           +if ($result->num_rows > 0) {
           +    echo "<table>\n";
           +    // Output data of each row
           +    while($row = $result->fetch_assoc()) {
           +      echo "\t<tr>\n";
           +      foreach ($row as $col_value) {
           +          print "\t\t<td>$col_value</td>\n";
           +      }
           +      echo "\t</tr>\n";
           +    }
           +    echo "</table>";
           +} else {
           +    echo "0 results";
           +}
           +
           +// Close connection
           +$conn->close();
           +?>
           +</body>
           +</html>
       [2017-03-30T20:37:18+00:00] INFO: httpd_config[default] sending restart action to httpd_service_debian_sysvinit[default] (delayed)
       Recipe: lamp::web
         * httpd_service_debian_sysvinit[default] action restart[2017-03-30T20:37:18+00:00] INFO: Processing httpd_service_debian_sysvinit[default] action restart (lamp::web line 12)

           * service[apache2-default] action restart[2017-03-30T20:37:18+00:00] INFO: Processing service[apache2-default] action restart (/tmp/kitchen/cache/cookbooks/httpd/libraries/httpd_service_debian_sysvinit.rb line 35)
       [2017-03-30T20:37:20+00:00] INFO: service[apache2-default] restarted

             - restart service service[apache2-default]

       [2017-03-30T20:37:20+00:00] INFO: Chef Run complete in 236.808128022 seconds

       Running handlers:
       [2017-03-30T20:37:20+00:00] INFO: Running report handlers
       Running handlers complete
       [2017-03-30T20:37:20+00:00] INFO: Report handlers complete

       Deprecated features used!
         Chef::Platform.set is deprecated at 14 locations:
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:4:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:5:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:6:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:7:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:8:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:9:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:10:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:11:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:12:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:13:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:14:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:15:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:16:in `<top (required)>'
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/z_provider_mapping.rb:17:in `<top (required)>'
          See https://docs.chef.io/deprecations_chef_platform_methods.html for further details.
         Chef::Platform.find_provider_for_node is deprecated at 1 location:
           - /opt/chef/embedded/lib/ruby/2.3.0/forwardable.rb:189:in `execute_each_resource'
          See https://docs.chef.io/deprecations_chef_platform_methods.html for further details.
         Chef::Platform.find_provider is deprecated at 1 location:
           - /opt/chef/embedded/lib/ruby/2.3.0/forwardable.rb:189:in `execute_each_resource'
          See https://docs.chef.io/deprecations_chef_platform_methods.html for further details.
         Chef::Platform.find is deprecated at 1 location:
           - /opt/chef/embedded/lib/ruby/2.3.0/forwardable.rb:189:in `execute_each_resource'
          See https://docs.chef.io/deprecations_chef_platform_methods.html for further details.
         nil is an invalid value for version of resource . In Chef 13, this warning will change to an error. Error: Property version must be one of: String!  You passed nil. at 1 location:
           - /tmp/kitchen/cache/cookbooks/mysql2_chef_gem/libraries/provider_mysql2_chef_gem_mysql.rb:17:in `block (2 levels) in <class:Mysql>'
          See https://docs.chef.io/deprecations_custom_resource_cleanups.html for further details.

       Chef Client finished, 136/216 resources updated in 03 minutes 58 seconds
       Finished converging <default-ubuntu-1404> (4m40.61s).
-----> Setting up <default-ubuntu-1404>...
       Finished setting up <default-ubuntu-1404> (0m0.00s).
-----> Verifying <default-ubuntu-1404>...
       Loaded

Target:  ssh://vagrant@127.0.0.1:2222


  Command mysql
     âœ”  -h 127.0.0.1 -uroot -pfakerootpassword -D 4thcoffee -e 'describe customers;' stdout should match /id/
  Command wget
     âœ”  -qO- localhost stdout should match /Customers/

Test Summary: 2 successful, 0 failures, 0 skipped
       Finished verifying <default-ubuntu-1404> (0m0.82s).
-----> Destroying <default-ubuntu-1404>...
       ==> default: Forcing shutdown of VM...
       ==> default: Destroying VM and associated drives...
       Vagrant instance <default-ubuntu-1404> destroyed.
       Finished destroying <default-ubuntu-1404> (0m4.12s).
       Finished testing <default-ubuntu-1404> (5m22.61s).
-----> Kitchen is finished. (5m23.53s)
